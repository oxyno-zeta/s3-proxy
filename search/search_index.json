{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#why","title":"Why ?","text":"<p>First of all, yes, this is another S3 proxy written in Golang.</p> <p>I've created this project because I couldn't find any other that allow to proxy multiple S3 buckets or to have custom templates with OpenID Connect authentication and also to get, upload and delete files.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Multi S3 bucket proxy</li> <li>Index document (display index document instead of listing when found)</li> <li>Custom templates</li> <li>AWS S3 Login from files or environment variables</li> <li>Custom S3 endpoints supported</li> <li>Basic Authentication support</li> <li>Multiple Basic Authentication support</li> <li>OpenID Connect Authentication support</li> <li>Multiple OpenID Connect Provider support</li> <li>Redirect to original host and path with OpenID Connect authentication</li> <li>Target mount point configuration with hostname and multiple path support</li> <li>Authentication by path and http method on each bucket</li> <li>Allow to publish files on S3 bucket</li> <li>Allow to delete files on S3 bucket</li> <li>Open Policy Agent integration for authorizations</li> <li>Configuration hot reload</li> <li>CORS support</li> <li>Prometheus metrics</li> <li>S3 Key Rewrite possibility</li> </ul> <p>See more information on these features in the \"Feature Guide\".</p>"},{"location":"#advanced-interfaces","title":"Advanced interfaces","text":"<p>Looking for more advanced interfaces. Take a look on this project: s3-proxy-interfaces.</p> <p>Provided interfaces in the project are really simple and based on NGinX template. Those are React based, with Material design and with customization.</p>"},{"location":"#want-to-contribute","title":"Want to contribute ?","text":"<ul> <li>Read the CONTRIBUTING guide</li> </ul>"},{"location":"#inspired-by","title":"Inspired by","text":"<ul> <li>pottava/aws-s3-proxy</li> </ul>"},{"location":"#thanks","title":"Thanks","text":"<ul> <li>My wife BH to support me doing this</li> </ul>"},{"location":"#author","title":"Author","text":"<ul> <li>Oxyno-zeta (Havrileck Alexandre)</li> </ul>"},{"location":"#license","title":"License","text":"<p>Apache 2.0 (See in LICENSE)</p>"},{"location":"CONTRIBUTING/","title":"Contributing","text":"<p>\u2665 We love pull requests from everyone !</p> <p>When contributing to this repository, please first discuss the change you wish to make via issue, email, or any other method with the owners of this repository before making a change.</p>"},{"location":"CONTRIBUTING/#so-all-code-changes-happen-through-pull-requests","title":"So all code changes happen through Pull Requests","text":"<p>Pull requests are the best way to propose changes to the codebase. We actively welcome your pull requests:</p> <ol> <li>Fork the repo and create your branch from <code>master</code>.</li> <li>If you've added code that should be tested, add tests.</li> <li>If you've added code that need documentation, update the documentation.</li> <li>Make sure your code follows the effective go guidelines as much as possible.</li> <li>Be sure to test your modifications.</li> <li>Write a good commit message following the conventionalcommits with the Angular convention.</li> <li>Issue that pull request!</li> </ol>"},{"location":"CONTRIBUTING/#code-of-conduct","title":"Code of conduct","text":"<p>Please note by participating in this project, you agree to abide by the code of conduct.</p>"},{"location":"CONTRIBUTING/#any-contributions-you-make-will-be-under-the-apache-license-20","title":"Any contributions you make will be under the Apache License 2.0","text":"<p>In short, when you submit code changes, your submissions are understood to be under the same Apache License 2.0 that covers the project. Feel free to contact the maintainers if that's a concern.</p>"},{"location":"CONTRIBUTING/#report-bugs-using-githubs-issues","title":"Report bugs using Github's issues","text":"<p>We use GitHub issues to track public bugs. Report a bug by opening a new issue; it's that easy!</p>"},{"location":"migrate-v3-to-v4/","title":"Migrate from v3 to v4","text":"<p>Several breaking changes have been done during this release on the configuration:</p> <ul> <li>Targets</li> <li>Templates structure and naming</li> <li>TargetTemplates structure and naming</li> <li>Default template names</li> <li>Index document</li> </ul> <p>Those changes have been made in order to have a better merge feature on the configuration, for new features and to keep things in sync and organized.</p> <p>Here is a diff of the configuration with highlighted keys you will have to change during the upgrade:</p> <pre><code> # Template configurations\n # templates:\n-#   badRequest: templates/bad-request.tpl\n-#   folderList: templates/folder-list.tpl\n-#   forbidden: templates/forbidden.tpl\n-#   internalServerError: templates/internal-server-error.tpl\n-#   notFound: templates/not-found.tpl\n-#   targetList: templates/target-list.tpl\n-#   unauthorized: templates/unauthorized.tpl\n+#   helpers:\n+#     - templates/_helpers.tpl\n+#   targetList:\n+#     path: templates/target-list.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n+#   folderList:\n+#     path: templates/folder-list.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n+#   badRequestError:\n+#     path: templates/bad-request-error.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n+#   forbiddenError:\n+#     path: templates/forbidden-error.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n+#   internalServerError:\n+#     path: templates/internal-server-error.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n+#   notFoundError:\n+#     path: templates/not-found-error.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n+#   unauthorizedError:\n+#     path: templates/unauthorized-error.tpl\n+#     headers:\n+#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n\n # Authentication Providers\n # authProviders:\n@@ -136,9 +159,9 @@ log:\n #           password:\n #             path: password1-in-file\n\n-# Targets\n+# Targets map\n targets:\n-  - name: first-bucket\n+  first-bucket:\n     ## Mount point\n     mount:\n       path:\n@@ -189,18 +212,20 @@ targets:\n     #       authorizationOPAServer:\n     #         # OPA server url with data path\n     #         url: http://localhost:8181/v1/data/example/authz/allowed\n-    # ## DEPRECATED Index document to display if exists in folder\n-    # indexDocument: index.html\n     # ## Actions\n     # actions:\n     #   # Action for GET requests on target\n     #   GET:\n     #     # Will allow GET requests\n     #     enabled: true\n-    #     # Redirect with trailing slash when a file isn't found\n-    #     redirectWithTrailingSlashForNotFoundFile: true\n-    #     # Index document to display if exists in folder\n-    #     indexDocument: index.html\n+    #     # Configuration for GET requests\n+    #     config:\n+    #       # Redirect with trailing slash when a file isn't found\n+    #       redirectWithTrailingSlashForNotFoundFile: true\n+    #       # Index document to display if exists in folder\n+    #       indexDocument: index.html\n+    #       # Allow to add headers to streamed files (can be templated)\n+    #       streamedFileHeaders: {}\n     #   # Action for PUT requests on target\n     #   PUT:\n     #     # Will allow PUT requests\n@@ -229,30 +254,40 @@ targets:\n     #     target: /$two/$one/$three/$one/\n     ## Target custom templates\n     # templates:\n+    #   # Helpers\n+    #   helpers:\n+    #   - inBucket: false\n+    #     path: \"\"\n     #   # Folder list template\n     #   folderList:\n     #     inBucket: false\n     #     path: \"\"\n-    #   # Not found template\n-    #   notFound:\n+    #     headers: {}\n+    #   # Not found error template\n+    #   notFoundError:\n     #     inBucket: false\n     #     path: \"\"\n+    #     headers: {}\n     #   # Internal server error template\n     #   internalServerError:\n     #     inBucket: false\n     #     path: \"\"\n-    #   # Forbidden template\n-    #   forbidden:\n+    #     headers: {}\n+    #   # Forbidden error template\n+    #   forbiddenError:\n     #     inBucket: false\n     #     path: \"\"\n-    #   # Unauthorized template\n-    #   unauthorized:\n+    #     headers: {}\n+    #   # Unauthorized error template\n+    #   unauthorizedError:\n     #     inBucket: false\n     #     path: \"\"\n-    #   # BadRequest template\n-    #   badRequest:\n+    #     headers: {}\n+    #   # Bad Request error template\n+    #   badRequestError:\n     #     inBucket: false\n     #     path: \"\"\n+    #     headers: {}\n     ## Bucket configuration\n     bucket:\n       name: super-bucket\n</code></pre>"},{"location":"configuration/example/","title":"Example","text":"<p>Note</p> <p>The following example is a full file example. But this can be split in multiple files, it will be merged by S3-Proxy automatically.</p> <p>Here is a full example of a configuration file:</p> <pre><code># Log configuration\nlog:\n  # Log level\n  level: info\n  # Log format\n  format: text\n  # Log file path\n  # filePath:\n\n# Metrics configuration\nmetrics:\n  # Disable router path save in HTTP metrics\n  disableRouterPath: false\n\n# Server configurations\n# server:\n#   listenAddr: \"\"\n#   port: 8080\n#   # Server timeout options\n#   timeouts:\n#     readTimeout: \"\"\n#     readHeaderTimeout: \"\"\n#     writeTimeout: \"\"\n#     idleTimeout: \"\"\n#   # Compress options\n#   compress:\n#     enabled: true\n#     # Compression level\n#     # level: 5\n#     # Types\n#     # types:\n#     #   - text/html\n#     #   - text/css\n#     #   - text/plain\n#     #   - text/javascript\n#     #   - application/javascript\n#     #   - application/x-javascript\n#     #   - application/json\n#     #   - application/atom+xml\n#     #   - application/rss+xml\n#     #   - image/svg+xml\n#   # CORS configuration\n#   cors:\n#     # Enabled\n#     enabled: false\n#     # Allow all traffic\n#     allowAll: true\n#     # Allow Origins\n#     # Example: https://fake.com\n#     allowOrigins: []\n#     # Allow HTTP Methods\n#     allowMethods: []\n#     # Allow Headers\n#     allowHeaders: []\n#     # Expose Headers\n#     exposeHeaders: []\n#     # Max age\n#     # 300 is the maximum value not ignored by any of major browsers\n#     # Source: https://github.com/go-chi/cors\n#     maxAge: 0\n#     # Allow credentials\n#     allowCredentials: false\n#     # Run debug\n#     debug: false\n#     # OPTIONS method Passthrough\n#     optionsPassthrough: false\n#   # Cache configuration\n#   cache:\n#     # Force no cache headers on all responses\n#     noCacheEnabled: true\n#     # Expires header value\n#     expires:\n#     # Cache-control header value\n#     cacheControl:\n#     # Pragma header value\n#     pragma:\n#     # X-Accel-Expires header value\n#     xAccelExpires:\n#   # SSL/TLS configuration\n#   ssl:\n#     # Is SSL/TLS configuration enabled ?\n#     enabled: true\n#     # Certificates to serve when connected\n#     certificates:\n#       - # Note: Exactly one of certificate/certificateUrl and privateKey/privateKeyUrl must be specified.\n#         # The PEM encoded certificate\n#         certificate: |\n#           -----BEGIN CERTIFICATE-----\n#           ....\n#           -----END CERTIFICATE-----\n#         # The URL of a resource containing the certificate\n#         # Check other URL types in documentation\n#         certificateUrl: arn:aws:ssm:region:accountId:parameter/name\n#         # Additional URL configuration if certificateUrl is an S3 URL\n#         certificateUrlConfig:\n#           # Timeout for HTTP connections (including AWS calls) to get SSL certificate/keys\n#           httpTimeout:\n#           # AWS region for S3/SSM/Secrets Manager-stored documents\n#           awsRegion: us-east-1\n#           # Custom endpoint for S3/SSM/Secrets Manager API calls\n#           awsEndpoint:\n#           # Credentials to access AWS-based documents\n#           awsCredentials:\n#             accessKey:\n#               env: AWS_ACCESS_KEY_ID\n#             secretKey:\n#               path: secret_key_file\n#           # Disable SSL for AWS API calls. This does not affect `https` URLs\n#           awsDisableSSL: false\n#         # The PEM encoded private key\n#         privateKey: |\n#           -----BEGIN RSA PRIVATE KEY-----\n#           -----END RSA PRIVATE KEY-----\n#         # Additional URL configuration if privateKeyUrl is an S3 URL\n#         # Check other URL types in documentation\n#         privateKeyUrl: arn:aws:secretsmanager:region:accountId:secret/name\n#         # Additional URL configuration if privateKeyUrl is an S3 URL\n#         privateKeyUrlConfig:\n#           # Timeout for HTTP connections (including AWS calls) to get SSL certificate/keys\n#           httpTimeout:\n#           # AWS region for S3/SSM/Secrets Manager-stored documents\n#           awsRegion: us-east-1\n#           # Custom endpoint for S3/SSM/Secrets Manager API calls\n#           awsEndpoint:\n#           # Credentials to access AWS-based documents\n#           awsCredentials:\n#             accessKey:\n#               env: AWS_ACCESS_KEY_ID\n#             secretKey:\n#               path: secret_key_file\n#           # Disable SSL for AWS API calls. This does not affect `https` URLs\n#           awsDisableSSL: false\n#     # List of hostnames to generate self-signed certificates for\n#     selfSignedHostnames:\n#       - localhost\n#       - localhost.localdomain\n#     # The minimum TLS version to allow when a client connects\n#     minTLSVersion: TLSv1.2\n#     # The maximum TLS version to allow when a client connects\n#     maxTLSVersion: TLSv1.3\n#     # The TLS ciphers to enable\n#     cipherSuites: # See https://pkg.go.dev/crypto/tls#pkg-constants for valid names; the current default is shown below.\n#       - TLS_AES_128_GCM_SHA256\n#       - TLS_AES_256_GCM_SHA384\n#       - TLS_CHACHA20_POLY1305_SHA256\n#       - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\n#       - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\n#       - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256\n\n# Template configurations\n# templates:\n#   helpers:\n#     - templates/_helpers.tpl\n#   targetList:\n#     path: templates/target-list.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"200\"\n#   folderList:\n#     path: templates/folder-list.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"200\"\n#   badRequestError:\n#     path: templates/bad-request-error.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"400\"\n#   forbiddenError:\n#     path: templates/forbidden-error.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"403\"\n#   internalServerError:\n#     path: templates/internal-server-error.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"500\"\n#   notFoundError:\n#     path: templates/not-found-error.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"404\"\n#   unauthorizedError:\n#     path: templates/unauthorized-error.tpl\n#     headers:\n#       Content-Type: '{{ template \"main.headers.contentType\" . }}'\n#     status: \"401\"\n#   put:\n#     path: templates/put.tpl\n#     headers: {}\n#     status: \"204\"\n#   delete:\n#     path: templates/delete.tpl\n#     headers: {}\n#     status: \"204\"\n\n# Authentication Providers\n# authProviders:\n#   # Header providers\n#   # This authentication method should be used only with a software like [Oauth2-proxy](https://github.com/oauth2-proxy/oauth2-proxy) or an authentication gateway that put headers with user information inside.\n#   # Warning: S3-proxy won't validate headers value or anything else. It will take values as they are coming.\n#   header:\n#     oauth2-proxy:\n#       usernameHeader: x-forwarded-preferred-username\n#       emailHeader: x-forwarded-email\n#       groupsHeader: x-forwarded-groups\n#   # OIDC providers\n#   oidc:\n#     provider1:\n#       clientID: client-id\n#       clientSecret:\n#         path: client-secret-in-file # client secret file\n#       state: my-secret-state-key # do not use this in production ! put something random here\n#       issuerUrl: https://issuer-url/\n#       redirectUrl: http://localhost:8080/ # /auth/oidc/callback will be added automatically\n#       scopes: # OIDC Scopes (defaults: openid, email, profile)\n#         - openid\n#         - email\n#         - profile\n#       groupClaim: groups # path in token\n#       # cookieDomains: [] # Cookie domains matching the request host\n#       # cookieSecure: true # Is the cookie generated secure ?\n#       # cookieName: oidc # Cookie generated name\n#       emailVerified: true # check email verified field from token\n#       # loginPath: /auth/provider1 # Override login path dynamically generated from provider key\n#       # callbackPath: /auth/provider1/callback # Override callback path dynamically generated from provider key\n#   # Basic auth providers\n#   basic:\n#     provider2:\n#       realm: My Basic Auth Realm\n\n# List targets feature\n# This will generate a webpage with list of targets with links using targetList template\n# listTargets:\n#   # To enable the list targets feature\n#   enabled: false\n#   ## Mount point\n#   mount:\n#     path:\n#       - /\n#     # A specific host can be added for filtering. Otherwise, all hosts will be accepted\n#     # host: localhost:8080\n#   ## Resource configuration\n#   resource:\n#     # A Path must be declared for a resource filtering\n#     path: /\n#     # HTTP Methods authorized (Must be in HEAD, GET, PUT or DELETE)\n#     methods:\n#       - GET\n#       - PUT\n#       - DELETE\n#     # Whitelist\n#     whitelist: false\n#     # A authentication provider declared in section before, here is the key name\n#     provider: provider1\n#     # OIDC section for access filter\n#     oidc:\n#       # NOTE: This list can be empty ([]) for authentication only and no group filter\n#       authorizationAccesses: # Authorization accesses : groups or email or regexp\n#         - group: devops_users\n#     # Header section for access filter\n#     header:\n#       # NOTE: This list can be empty ([]) for authentication only and no group filter\n#       authorizationAccesses: # Authorization accesses : groups or email or regexp\n#         - group: devops_users\n#     # Basic authentication section\n#     basic:\n#       credentials:\n#         - user: user1\n#           password:\n#             path: password1-in-file\n\n# Targets map\ntargets:\n  first-bucket:\n    ## Mount point\n    mount:\n      path:\n        - /\n      # A specific host can be added for filtering. Otherwise, all hosts will be accepted\n      # host: localhost:8080\n    # ## Resources declaration\n    # ## WARNING: Think about all path that you want to protect. At the end of the list, you should add a resource filter for /* otherwise, it will be public.\n    # resources:\n    #   # A Path must be declared for a resource filtering (a wildcard can be added to match every sub path)\n    #   - path: /\n    #     # Whitelist\n    #     whiteList: true\n    #   # A Path must be declared for a resource filtering (a wildcard can be added to match every sub path)\n    #   - path: /specific_doc/*\n    #     # HTTP Methods authorized (Must be in HEAD, GET, PUT or DELETE)\n    #     methods:\n    #       - GET\n    #       - PUT\n    #       - DELETE\n    #     # A authentication provider declared in section before, here is the key name\n    #     provider: provider1\n    #     # OIDC section for access filter\n    #     oidc:\n    #       # NOTE: This list can be empty ([]) for authentication only and no group filter\n    #       authorizationAccesses: # Authorization accesses : groups or email or regexp\n    #         - group: specific_users\n    #   # A Path must be declared for a resource filtering (a wildcard can be added to match every sub path)\n    #   - path: /directory1/*\n    #     # HTTP Methods authorized (Must be in HEAD, GET, PUT or DELETE)\n    #     methods:\n    #       - GET\n    #       - PUT\n    #       - DELETE\n    #     # A authentication provider declared in section before, here is the key name\n    #     provider: provider1\n    #     # Basic authentication section\n    #     basic:\n    #       credentials:\n    #         - user: user1\n    #           password:\n    #             path: password1-in-file\n    #   # A Path must be declared for a resource filtering (a wildcard can be added to match every sub path)\n    #   - path: /opa-protected/*\n    #     # OIDC section for access filter\n    #     oidc:\n    #       # Authorization through OPA server configuration\n    #       authorizationOPAServer:\n    #         # OPA server url with data path\n    #         url: http://localhost:8181/v1/data/example/authz/allowed\n    #   # A Path must be declared for a resource filtering (a wildcard can be added to match every sub path)\n    #   - path: /specific_doc/*\n    #     # HTTP Methods authorized (Must be in HEAD, GET, PUT or DELETE)\n    #     methods:\n    #       - GET\n    #       - PUT\n    #       - DELETE\n    #     # A authentication provider declared in section before, here is the key name\n    #     provider: provider1\n    #     # Header section for access filter\n    #     header:\n    #       # NOTE: This list can be empty ([]) for authentication only and no group filter\n    #       authorizationAccesses: # Authorization accesses : groups or email or regexp\n    #         - group: specific_users\n    #   # A Path must be declared for a resource filtering (a wildcard can be added to match every sub path)\n    #   - path: /opa-protected/*\n    #     # Header section for access filter\n    #     header:\n    #       # Authorization through OPA server configuration\n    #       authorizationOPAServer:\n    #         # OPA server url with data path\n    #         url: http://localhost:8181/v1/data/example/authz/allowed\n    # ## Actions\n    # actions:\n    #   # Action for HEAD requests on target\n    #   HEAD:\n    #     # Will allow HEAD requests\n    #     enabled: true\n    #     # Configuration for HEAD requests\n    #     config:\n    #       # Webhooks\n    #       webhooks: []\n    #   # Action for GET requests on target\n    #   GET:\n    #     # Will allow GET requests\n    #     enabled: true\n    #     # Configuration for GET requests\n    #     config:\n    #       # Redirect with trailing slash when a file isn't found\n    #       redirectWithTrailingSlashForNotFoundFile: true\n    #       # Index document to display if exists in folder\n    #       indexDocument: index.html\n    #       # Allow to add headers to streamed files (can be templated)\n    #       streamedFileHeaders: {}\n    #       # Redirect to a S3 signed URL\n    #       redirectToSignedUrl: true\n    #       # Signed URL expiration time\n    #       signedUrlExpiration: 15m\n    #       # Disable listing\n    #       # Note: This will return an empty list or you should change the folder list template (in general or in this target)\n    #       disableListing: false\n    #       # Webhooks\n    #       webhooks: []\n    #   # Action for PUT requests on target\n    #   PUT:\n    #     # Will allow PUT requests\n    #     enabled: true\n    #     # Configuration for PUT requests\n    #     config:\n    #       # Metadata key/values that will be put on S3 objects.\n    #       # Values can be templated. Empty values will be flushed.\n    #       metadata:\n    #         key: value\n    #       # System Metadata cases.\n    #       # Values can be templated. Empty values will be flushed.\n    #       systemMetadata:\n    #         # Cache-Control value (will be put as header after)\n    #         cacheControl: \"\"\n    #         # Content-Disposition value (will be put as header after)\n    #         contentDisposition: \"\"\n    #         # Content-Encoding value (will be put as header after)\n    #         contentEncoding: \"\"\n    #         # Content-Language value (will be put as header after)\n    #         contentLanguage: \"\"\n    #         # Expires value (will be put as header after)\n    #         # Side note: This must have the RFC3339 date format at the end.\n    #         expires: \"\"\n    #       # Storage class that will be used for uploaded objects\n    #       # See storage class here: https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html\n    #       # Values can be templated. Empty values will be flushed.\n    #       storageClass: STANDARD # GLACIER, ...\n    #       # Will allow override objects if enabled\n    #       allowOverride: false\n    #       # Canned ACL put on each file uploaded.\n    #       # https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl\n    #       # cannedACL: \"\"\n    #       # Webhooks\n    #       webhooks: []\n    #   # Action for DELETE requests on target\n    #   DELETE:\n    #     # Will allow DELETE requests\n    #     enabled: true\n    #     # Configuration for DELETE requests\n    #     config:\n    #       # Webhooks\n    #       webhooks: []\n    # # Key rewrite list\n    # # This will allow to rewrite keys before doing any requests to S3\n    # # For more information about how this works, see in the documentation.\n    # keyRewriteList:\n    #   - # Source represents a Regexp (golang format with group naming support)\n    #     source: ^/(?P&lt;one&gt;\\w+)/(?P&lt;two&gt;\\w+)/(?P&lt;three&gt;\\w+)?$\n    #     # Target type: Regex or Template\n    #     # Regex will allow to do a simple regex replace/update, like in the example\n    #     # Template will allow to do golang template replace, like this example as \"target\" value: {{ regexReplaceAll \"/input1(/.*)\" .Key (printf \"/input1/%s${1}\" .User.Username) }}\n    #     # targetType: REGEX # TEMPLATE\n    #     # Target represents the template of the new key that will be used\n    #     target: /$two/$one/$three/$one/\n    ## Target custom templates\n    # templates:\n    #   # Helpers\n    #   helpers:\n    #   - inBucket: false\n    #     path: \"\"\n    #   # Folder list template\n    #   folderList:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"200\"\n    #   # Not found error template\n    #   notFoundError:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"404\"\n    #   # Internal server error template\n    #   internalServerError:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"500\"\n    #   # Forbidden error template\n    #   forbiddenError:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"403\"\n    #   # Unauthorized error template\n    #   unauthorizedError:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"401\"\n    #   # Bad Request error template\n    #   badRequestError:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"400\"\n    #   # PUT template\n    #   put:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"204\"\n    #   # DELETE template\n    #   delete:\n    #     inBucket: false\n    #     path: \"\"\n    #     headers: {}\n    #     status: \"204\"\n    ## Bucket configuration\n    bucket:\n      name: super-bucket\n      prefix:\n      region: eu-west-1\n      s3Endpoint:\n      disableSSL: false\n      # s3MaxUploadParts: 10000\n      # s3UploadPartSize: 5\n      # s3UploadConcurrency: 5\n      # s3UploadLeavePartsOnError: false\n      # s3ListMaxKeys: 1000\n      # credentials:\n      #   accessKey:\n      #     env: AWS_ACCESS_KEY_ID\n      #   secretKey:\n      #     path: secret_key_file\n      # requestConfig:\n      #   listHeaders:\n      #     Accept-Encoding: gzip\n      #   getHeaders:\n      #     Accept-Encoding: gzip\n      #   putHeaders:\n      #     Accept-Encoding: gzip\n      #   deleteHeaders:\n      #     Accept-Encoding: gzip\n</code></pre>"},{"location":"configuration/structure/","title":"Structure","text":"<p>The configuration must be set in multiple YAML files located in <code>conf/</code> folder from the current working directory.</p> <p>You can create multiple files containing different part of the configuration. A global merge will be done across all data in all files.</p> <p>Moreover, the configuration files will be watched for modifications.</p> <p>You can see a full example in the Example section</p>"},{"location":"configuration/structure/#main-structure","title":"Main structure","text":"Key Type Required Default Description log LogConfiguration No None Log configurations server ServerConfiguration No None Server configurations internalServer ServerConfiguration No None Internal Server configurations template TemplateConfiguration No None Template configurations targets Map[String]targetconfiguration No None Targets configuration. Map key will be considered as the target name. (This will used in urls and list of targets.) authProviders AuthProvidersConfiguration No None Authentication providers configuration listTargets ListTargetsConfiguration No None List targets feature configuration metrics MetricsConfiguration No None Metrics configurations"},{"location":"configuration/structure/#metricsconfiguration","title":"MetricsConfiguration","text":"Key Type Required Default Description disableRouterPath Boolean No <code>false</code> Disable router path exported in metrics."},{"location":"configuration/structure/#logconfiguration","title":"LogConfiguration","text":"Key Type Required Default Description level String No <code>info</code> Log level format String No <code>json</code> Log format (available values are: <code>json</code> or <code>text</code>) filePath String No <code>\"\"</code> Log file path"},{"location":"configuration/structure/#serverconfiguration","title":"ServerConfiguration","text":"Key Type Required Default Description listenAddr String No <code>\"\"</code> Listen Address (Important: Cannot be hot reloaded) port Integer No <code>8080</code> Listening Port (Important: Cannot be hot reloaded) cors ServerCorsConfig No None CORS configuration cache ServerCacheConfig No None\u00a0 Cache configuration ssl ServerSSLConfig No None SSL/TLS configuration (Important: Cannot be hot reloaded)"},{"location":"configuration/structure/#servertimeoutsconfig","title":"ServerTimeoutsConfig","text":"Key Type Required Default Description readTimeout string No <code>\"\"</code> Server read timeout readHeaderTimeout string No <code>\"60s\"</code> (to avoid Slowloris attack) Server read header timeout writeTimeout string No <code>\"\"</code> Server write timeout idleTimeout string No <code>\"\"</code> Server idle timeout"},{"location":"configuration/structure/#servercompressconfig","title":"ServerCompressConfig","text":"Key Type Required Default Description enabled Boolean No <code>true</code> \u00a0Is the compression enabled ? level Integer No <code>5</code> The level of GZip compression types [String] No <code>[\"text/html\",\"text/css\",\"text/plain\",\"text/javascript\",\"application/javascript\",\"application/x-javascript\",\"application/json\",\"application/atom+xml\",\"application/rss+xml\",\"image/svg+xml\"]</code> The content type list compressed in output"},{"location":"configuration/structure/#servercacheconfig","title":"ServerCacheConfig","text":"Key Type Required Default Description noCacheEnabled Boolean false <code>false</code> Force no cache headers on all responses expires String false <code>\"\"</code> <code>Expires</code> header value cacheControl String false <code>\"\"</code> <code>Cache-Control</code> header value pragma String false <code>\"\"</code> <code>Pragma</code> header value xAccelExpires String false <code>\"\"</code> <code>X-Accel-Expires</code> header value <p>See more information here.</p>"},{"location":"configuration/structure/#servercorsconfig","title":"ServerCorsConfig","text":"<p>This feature is powered by go-chi/cors. You can read more documentation about all field there.</p> Key Type Required Default Description enabled Boolean No <code>false</code> Is CORS support enabled ? allowAll Boolean No <code>false</code> Allow all CORS requests with all origins, all HTTP methods, etc ? allowOrigins [String] No Allow origins array. Example: https://fake.com. This support stars in origins. allowMethods [String] No Allow HTTP Methods allowHeaders [String] No Allow headers exposeHeaders [String] No Expose headers maxAge Integer No Max age. 300 is the maximum value not ignored by any of major browsers. allowCredentials Boolean No Allow credentials debug Boolean No Debug mode for go-chi/cors optionsPassthrough Boolean No OPTIONS method Passthrough"},{"location":"configuration/structure/#serversslcertificate","title":"ServerSSLCertificate","text":"Key Type Required Default Description certificate String Yes[1] None The PEM encoded certificate. certificateUrl String Yes[1] None The URL of a resource containing the certificate. certificateUrlConfig SSLURLConfig No None Additional URL configuration if certificateUrl is an S3 URL. privateKey String Yes[2] None The PEM encoded private key. privateKeyUrl String Yes[2] None The URL of a resource containing the private key. privateKeyUrlConfig SSLURLConfig No None Additional URL configuration if privateKeyUrl is an S3 URL. <p>Notes:</p> <ul> <li>[1] Exactly one of <code>certificate</code> or <code>certificateUrl</code> must be specified.</li> <li>[2] Exactly one of <code>privateKey</code> or <code>privateKeyUrl</code> must be specified.</li> </ul> <p>Allowed URL types are:</p> <ul> <li>Local files, in <code>file:///absolute/path/filename</code>, <code>file://relative/path/filename</code>, <code>/absolute/path/filename</code>, or <code>relative/path/filename</code> form.</li> <li>HTTP/HTTPS URLs in <code>https://host[:port]/path</code> form.</li> <li>AWS S3 URLs in either <code>s3://bucket/key</code> or <code>arn:partition:s3:::bucket/key</code> form.</li> <li>AWS Secrets Manager ARNs in <code>arn:partition:secretsmanager:region:account-id:secret/secret-name</code> form.</li> <li>AWS Systems Manager parameter ARNs in <code>arn:partition:ssm:region:account-id:parameter/path/name</code> form.</li> </ul>"},{"location":"configuration/structure/#serversslconfig","title":"ServerSSLConfig","text":"Key Type Required Default Description enabled Boolean No <code>false</code> Whether SSL support should be enabled. certificates [ServerSSLCertificate] No [] Certificates to serve when connected. selfSignedHostnames [String] No [] List of hostnames to generate self-signed certificates for. minTLSVersion String No <code>\"TLSv1.2\"</code> The minimum TLS version to allow when a client connects. maxTLSVersion String No None The maximum TLS version to allow when a client connects. cipherSuites [String] No See below The TLS ciphers to enable. <p>The values for <code>cipherSuites</code> are the constant names in the Go crypto/tls package, starting with <code>TLS_</code>. The default ciphers are the recommended cipher suites from ciphersuite.info supported by Go:</p> <ul> <li><code>TLS_AES_128_GCM_SHA256</code></li> <li><code>TLS_AES_256_GCM_SHA384</code></li> <li><code>TLS_CHACHA20_POLY1305_SHA256</code></li> <li><code>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</code></li> <li><code>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</code></li> <li><code>TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</code></li> </ul>"},{"location":"configuration/structure/#sslurlconfig","title":"SSLURLConfig","text":"<p>This is a subset/modification of the configuration available from BucketConfiguration.</p> Key Type Required Default Description httpTimeout String (duration) No None Timeout for HTTP connections (including AWS calls) to get SSL certificate/keys. awsRegion String No <code>us-east-1</code> AWS region for S3/SSM/Secrets Manager-stored documents. awsEndpoint String No None Custom endpoint for S3/SSM/Secrets Manager API calls. awsCredentials BucketCredentialConfiguration No None Credentials to access AWS-based documents awsDisableSSL Boolean No <code>false</code> Disable SSL for AWS API calls. This does not affect <code>https</code> URLs."},{"location":"configuration/structure/#templateconfiguration","title":"TemplateConfiguration","text":"<p>Warning</p> <p>Override headers will remove the default value containing the <code>Content-Type</code> header. Why ? Because it was though that it was better to know why it is override and not have magical values coming from nowhere.</p> Key Type Required Default Description helpers [String] No <code>[templates/_helpers.tpl]</code> Template Golang helpers targetList TemplateConfigurationItem No <code>targetList: { path: \"templates/target-list.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"200\" }</code> Target list template configuration. More information here. folderList TemplateConfigurationItem No <code>folderList: { path: \"templates/folder-list.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"200\" }</code> Folder list template configuration. More information here. notFoundError TemplateConfigurationItem No <code>notFoundError: { path: \"templates/not-found-error.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"404\" }</code> Not found template configuration. More information here. unauthorizedError TemplateConfigurationItem No <code>unauthorizedError: { path: \"templates/unauthorized-error.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"401\" }</code> Unauthorized template configuration. More information here. forbiddenError TemplateConfigurationItem No <code>forbiddenError: { path: \"templates/forbidden-error.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"403\" }</code> Forbidden template configuration. More information here. badRequestError TemplateConfigurationItem No <code>badRequestError: { path: \"templates/bad-request-error.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"400\" }</code> Bad Request template configuration. More information here. internalServerError TemplateConfigurationItem No <code>internalServerError: { path: \"templates/internal-server-error.tpl\", headers: { \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\" }, status: \"500\" }</code> Internal server error template configuration. More information here. put TemplateConfigurationItem No <code>put: { path: \"templates/put.tpl\", headers: {}, status: \"204\" }</code> PUT response template configuration. More information here. delete TemplateConfigurationItem No <code>delete: { path: \"templates/put.tpl\", headers: {}, status: \"204\" }</code> DELETE response template configuration. More information here."},{"location":"configuration/structure/#templateconfigurationitem","title":"TemplateConfigurationItem","text":"Key Type Required Default Description path String True <code>\"\"</code> File path to template file headers Map[String]String False None Headers containing templates. Key corresponds to header and value to the template. If templated value is empty, the header won't be added to answer. More information here. status String False <code>\"\"</code> Status code template. It will be parsed to get an integer."},{"location":"configuration/structure/#targetconfiguration","title":"TargetConfiguration","text":"Key Type Required Default Description bucket BucketConfiguration Yes None Bucket configuration resources [Resource] No None Resources declaration for path whitelist or specific authentication on path list. WARNING: Think about all path that you want to protect. At the end of the list, you should add a resource filter for /* otherwise, it will be public. mount MountConfiguration Yes None Mount point configuration actions ActionsConfiguration No GET action enabled Actions allowed on target (GET, PUT or DELETE) keyRewriteList [KeyRewrite] No None Key rewrite list is here to allow rewriting keys before sending request to S3 (See more information here) templates TargetTemplateConfig No None Custom target templates from files on local filesystem or in bucket"},{"location":"configuration/structure/#keyrewrite","title":"KeyRewrite","text":"<p>See more information here.</p> Key Type Required Default Description source String Required None Source regexp matcher with golang group naming support. targetType String No <code>REGEX</code> Possible values are <code>REGEX</code> or <code>TEMPLATE</code>. target String Required None Target template for new key send to S3."},{"location":"configuration/structure/#targettemplateconfig","title":"TargetTemplateConfig","text":"Key Type Required Default Description helpers [TargetHelperConfigItem] No None Helpers list custom template declarations. folderList TargetTemplateConfigItem No None Folder list custom template declaration. More information here. notFoundError TargetTemplateConfigItem No None Not Found custom template declaration. More information here. internalServerError TargetTemplateConfigItem No None Internal server error custom template declaration. More information here. forbiddenError TargetTemplateConfigItem No None Forbidden custom template declaration. More information here. unauthorizedError TargetTemplateConfigItem No None Unauthorized custom template declaration. More information here. badRequestError TargetTemplateConfigItem No None Bad Request custom template declaration. More information here. put TargetTemplateConfigItem No None PUT custom template declaration. More information here. delete TargetTemplateConfigItem No None DELETE custom template declaration. More information here."},{"location":"configuration/structure/#targethelperconfigitem","title":"TargetHelperConfigItem","text":"Key Type Required Default Description inBucket Boolean No <code>false</code> Is the file in bucket or on local file system ? path String Yes None Path for template file"},{"location":"configuration/structure/#targettemplateconfigitem","title":"TargetTemplateConfigItem","text":"Key Type Required Default Description inBucket Boolean No <code>false</code> Is the file in bucket or on local file system ? path String Yes None Path for template file headers Map[String]String False This will be set to corresponding TemplateConfiguration if empty. Headers containing templates. Key corresponds to header and value to the template. If templated value is empty, the header won't be added to answer. More information here. status String Yes None Status code template. It will be parsed to get an integer."},{"location":"configuration/structure/#actionsconfiguration","title":"ActionsConfiguration","text":"Key Type Required Default Description HEAD HeadActionConfiguration No None Action configuration for HEAD requests on target GET GetActionConfiguration No None Action configuration for GET requests on target PUT PutActionConfiguration No None Action configuration for PUT requests on target DELETE DeleteActionConfiguration No None Action configuration for DELETE requests on target"},{"location":"configuration/structure/#headactionconfiguration","title":"HeadActionConfiguration","text":"Key Type Required Default Description enabled Boolean No <code>false</code> Will allow HEAD requests config HeadActionConfigConfiguration No None Configuration for HEAD requests"},{"location":"configuration/structure/#headactionconfigconfiguration","title":"HeadActionConfigConfiguration","text":"Key Type Required Default Description webhooks [WebhookConfiguration] No <code>nil</code> Webhooks configuration list to call when a HEAD request is performed"},{"location":"configuration/structure/#getactionconfiguration","title":"GetActionConfiguration","text":"Key Type Required Default Description enabled Boolean No <code>false</code> Will allow GET requests config GetActionConfigConfiguration No None Configuration for GET requests"},{"location":"configuration/structure/#getactionconfigconfiguration","title":"GetActionConfigConfiguration","text":"Key Type Required Default Description redirectWithTrailingSlashForNotFoundFile Boolean No <code>false</code> This option allow to do a redirect with a trailing slash when a GET request on a file (not a folder) encountered a 404 not found. indexDocument String No <code>\"\"</code> The index document name. If this document is found, get it instead of list folder. Example: <code>index.html</code> streamedFileHeaders Map[String]String No <code>nil</code> \u00a0Headers containing templates that will be added to streamed files in this target. Key corresponds to header and value to the template. If templated value is empty, the header won't be added to answer. More information here. redirectToSignedUrl Boolean No <code>false</code> Instead of streaming the file through S3-Proxy application, it will redirect to a S3 signed URL to perform the actual download. signedUrlExpiration String No <code>15m</code> This will allow to set an expiration time on generated signed URL. disableListing That will disable the listing action. That will display an empty list or you should change the folder list template (general or per target). No <code>false</code> webhooks [WebhookConfiguration] No <code>nil</code> Webhooks configuration list to call when a GET request is performed"},{"location":"configuration/structure/#putactionconfiguration","title":"PutActionConfiguration","text":"Key Type Required Default Description enabled Boolean No <code>false</code> Will allow PUT requests config PutActionConfigConfiguration No None Configuration for PUT requests"},{"location":"configuration/structure/#putactionconfigconfiguration","title":"PutActionConfigConfiguration","text":"Key Type Required Default Description metadata Map[String]String No None Metadata key/values that will be put on S3 objects. Map Values can be templated. Empty values will be flushed. See here systemMetadata PutActionConfigSystemMetadataConfiguration No <code>nil</code> This allow to put system metadata values to uploaded objects. Value can be templated. Empty values will be flushed. See here storageClass String No <code>\"\"</code> Storage class that will be used for uploaded objects. See storage class here: https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html. Value can be templated. Empty values will be flushed. See here allowOverride Boolean No <code>false</code> Will allow override objects if enabled cannedACL String No <code>nil</code> Canned ACL put on each file uploaded. See official values here https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl. webhooks [WebhookConfiguration] No <code>nil</code> Webhooks configuration list to call when a PUT request is performed"},{"location":"configuration/structure/#putactionconfigsystemmetadataconfiguration","title":"PutActionConfigSystemMetadataConfiguration","text":"Key Type Required Default Description cacheControl String <code>\"\"</code> Cache-Control value. Value can be templated. Empty values will be flushed. See here contentDisposition String <code>\"\"</code> Content-Disposition value. Value can be templated. Empty values will be flushed. See here contentEncoding String <code>\"\"</code> Content-Encoding value. Value can be templated. Empty values will be flushed. See here contentLanguage String <code>\"\"</code> Content-Language value. Value can be templated. Empty values will be flushed. See here expires String <code>\"\"</code> Expires value This must have the RFC3339 date format at the end. Value can be templated. Empty values will be flushed. See here"},{"location":"configuration/structure/#deleteactionconfiguration","title":"DeleteActionConfiguration","text":"Key Type Required Default Description enabled Boolean No <code>false</code> Will allow DELETE requests config DeleteActionConfigConfiguration No None Configuration for DELETE requests"},{"location":"configuration/structure/#deleteactionconfigconfiguration","title":"DeleteActionConfigConfiguration","text":"Key Type Required Default Description webhooks [WebhookConfiguration] No <code>nil</code> Webhooks configuration list to call when a DELETE request is performed"},{"location":"configuration/structure/#webhookconfiguration","title":"WebhookConfiguration","text":"<p>You can found more information here about webhooks and this works in the application.</p> Key Type Required Default Description method String Yes None HTTP Method used for webhook call. Can be <code>POST</code>, <code>PUT</code>, <code>DELETE</code> or <code>PATCH</code> url String Yes None URL to be called headers Map[String]String No <code>nil</code> Fixed headers secretHeaders Map[String]credentialconfiguration No <code>nil</code> Headers coming from secrets (for credentials for example) retryCount Integer No <code>0</code> Number of retry in case of error defaultWaitTime String No <code>\"\"</code> Default wait time to sleep before retrying request. Default is 100 ms (injected by HTTP client) maxWaitTime String No <code>\"\"</code> Max wait time to sleep before retrying request. Default is 2 seconds (injected by HTTP client)"},{"location":"configuration/structure/#bucketconfiguration","title":"BucketConfiguration","text":"Key Type Required Default Description name String Yes None Bucket name in S3 provider prefix String No None Bucket prefix region String No <code>us-east-1</code> Bucket region s3Endpoint String No None Custom S3 Endpoint for non AWS S3 bucket credentials BucketCredentialConfiguration No None Credentials to access S3 bucket disableSSL Boolean No <code>false</code> Disable SSL connection s3ListMaxKeys Integer No <code>1000</code> This flag will be used for the max pagination list management of files and \"folders\" in S3. In S3 list requests, the limit is fixed to 1000 items maximum. S3-Proxy will allow to increase this by making multiple requests to S3. Warning: This will increase the memory and CPU usage. requestConfig BucketRequestConfigConfiguration No <code>nil</code> This will allow to customize requests sent to your S3 backend. s3MaxUploadParts Integer No <code>10000</code> MaxUploadParts is the max number of parts which will be uploaded to S3. s3UploadPartSize Integer No <code>5</code> The buffer size (in megabytes) to use when buffering data into chunks and sending them as parts to S3. The minimum allowed part size is 5MB, and if this value is set to zero, the DefaultUploadPartSize value will be used. s3UploadConcurrency Integer No <code>5</code> The number of goroutines to spin up in parallel per call to Upload when sending parts. If this is set to zero, the DefaultUploadConcurrency value will be used. s3UploadLeavePartsOnError Boolean No <code>false</code> Setting this value to true will cause the SDK to avoid calling AbortMultipartUpload on a failure, leaving all successfully uploaded parts on S3 for manual recovery."},{"location":"configuration/structure/#bucketrequestconfigconfiguration","title":"BucketRequestConfigConfiguration","text":"Key Type Required Default Description listHeaders Map[string]string No <code>nil</code> Will allow to customize headers made to S3 provider on List requests getHeaders Map[string]string No <code>nil</code> Will allow to customize headers made to S3 provider on Get requests putHeaders Map[string]string No <code>nil</code> Will allow to customize headers made to S3 provider on Put requests deleteHeaders Map[string]string No <code>nil</code> Will allow to customize headers made to S3 provider on Delete requests"},{"location":"configuration/structure/#bucketcredentialconfiguration","title":"BucketCredentialConfiguration","text":"Key Type Required Default Description accessKey CredentialConfiguration No None S3 Access Key ID secretKey CredentialConfiguration No None S3 Secret Access Key"},{"location":"configuration/structure/#credentialconfiguration","title":"CredentialConfiguration","text":"Key Type Required Default Description path String Only if env and value are not set None File path contains credential in (Values loaded will be cleaned from new lines) env String Only if path and value are not set None Environment variable name to use to load credential value String Only if path and env are not set None Credential value directly (Not recommended)"},{"location":"configuration/structure/#authprovidersconfiguration","title":"AuthProvidersConfiguration","text":"Key Type Required Default Description basic map[string]BasicAuthConfiguration No None Basic Auth configuration and key as provider name oidc map[string]OIDCAuthConfiguration No None OIDC Auth configuration and key as provider name header map[string]HeaderAuthConfiguration No None Header Auth configuration and key as provider name"},{"location":"configuration/structure/#headerauthconfiguration","title":"HeaderAuthConfiguration","text":"<p>This authentication method should be used only with a software like Oauth2-proxy or an authentication gateway that put headers with user information inside.</p> <p>Warning</p> <p>S3-proxy won't validate headers value or anything else. It will take values as they are coming.</p> Key Type Required Default Description usernameHeader String Yes None Username header emailHeader String Yes None Email header groupsHeader [String] No <code>\"\"</code> Groups header. Note: Value must be a list of groups separated by comas (<code>,</code>)"},{"location":"configuration/structure/#oidcauthconfiguration","title":"OIDCAuthConfiguration","text":"Key Type Required Default Description clientID String Yes None Client ID clientSecret CredentialConfiguration No None Client Secret issuerUrl String Yes None Issuer URL (example: https://fake.com/realm/fake-realm redirectUrl String No <code>\"\"</code> Redirect URL (this is the service url). Without this being set, the redirect url will be calculated from input host automatically by S3-Proxy scopes [String] No <code>[\"openid\", \"profile\", \"email\"]</code> Scopes state String Yes None Random string to have a secure connection with oidc provider groupClaim String No <code>groups</code> Groups claim path in token (<code>groups</code> must be a list of strings containing user groups) emailVerified Boolean No <code>false</code> Check that user email is verified in user token (field <code>email_verified</code>) cookieName String No <code>oidc</code> Cookie generated name cookieSecure Boolean No <code>false</code> Is the cookie generated secure ? cookieDomains [String] No <code>nil</code> Cookie domains affected to generated cookie. If request host is matching one of the cookie domains defined, generated cookie will use the matching domain, otherwise, the domain will be the request host. loginPath String No <code>\"\"</code> Override login path for authentication. If not defined, <code>/auth/PROVIDER_NAME</code> will be used callbackPath String No <code>\"\"</code> Override callback path for authentication callback. If not defined,<code>/auth/PROVIDER_NAME/callback</code> will be used"},{"location":"configuration/structure/#basicauthconfiguration","title":"BasicAuthConfiguration","text":"Key Type Required Default Description realm String Yes None Basic Auth Realm"},{"location":"configuration/structure/#resource","title":"Resource","text":"Key Type Required Default Description path String Yes None Path or matching path (e.g.: <code>/*</code>) provider String Yes None Provider key reference methods [String] No <code>[GET]</code> HTTP methods allowed (Allowed values <code>HEAD</code>, <code>GET</code>, <code>PUT</code>, <code>DELETE</code>) whiteList Boolean Required without oidc or basic None Is this path in white list ? E.g.: No authentication basic ResourceBasic Required without whitelist, oidc or header None Basic auth configuration oidc ResourceHeaderOIDC Required without whitelist, basic or header None OIDC configuration authorization header ResourceHeaderOIDC Required without whitelist, oidc or basic None Header configuration authorization"},{"location":"configuration/structure/#resourceheaderoidc","title":"ResourceHeaderOIDC","text":"Key Type Required Default Description authorizationAccesses [HeaderOIDCAuthorizationAccesses] No None Authorization accesses matrix by group or email. If not set, authenticated users will be authorized (no group or email validation will be performed if authorizationOPAServer isn't set). This is based on the \"OR\" principle. Another way to say it is: you are authorized as soon as 1 thing (email or group) is matching. Check the guide here for more details. authorizationOPAServer OPAServerAuthorization No None Authorization through an OPA (Open Policy Agent) server"},{"location":"configuration/structure/#opaserverauthorization","title":"OPAServerAuthorization","text":"Key Type Required Default Description url String Yes None URL of the OPA server including the data path (see the dedicated section for OPA) tags Map[String]String No <code>{}</code> Data that will be added as tags in the OPA input data (see the dedicated section for OPA)"},{"location":"configuration/structure/#headeroidcauthorizationaccesses","title":"HeaderOIDCAuthorizationAccesses","text":"Key Type Required Default Description group String Required without email None Group name email String Required without group None Email regexp Boolean No <code>false</code> Consider group or email as regexp for matching forbidden Boolean No <code>false</code> This will consider anything matching group or email as a forbidden matching (regex enabled or not). This have been done because there isn't way to do a negative match on regex."},{"location":"configuration/structure/#resourcebasic","title":"ResourceBasic","text":"Key Type Required Default Description credentials [BasicAuthUserConfiguration] Yes None List of authorized user and password"},{"location":"configuration/structure/#basicauthuserconfiguration","title":"BasicAuthUserConfiguration","text":"Key Type Required Default Description user String Yes None User name password CredentialConfiguration Yes None User password"},{"location":"configuration/structure/#mountconfiguration","title":"MountConfiguration","text":"Key Type Required Default Description host String No <code>\"\"</code> Host domain requested (eg: localhost:888 or google.fr). Put empty for all domains. Note: Glob patterns for host domains are supported. path [String] Yes None A path list for mounting point"},{"location":"configuration/structure/#listtargetsconfiguration","title":"ListTargetsConfiguration","text":"Key Type Required Default Description enabled Boolean Yes None To enable the list targets feature mount MountConfiguration Yes None Mount point configuration resource Resource No None Resources declaration for path whitelist or specific authentication on path"},{"location":"feature-guide/api/","title":"API","text":""},{"location":"feature-guide/api/#get","title":"GET","text":"<p>This kind of requests will allow to get files or to perform a directory listing.</p> <p>There is 2 different management cases:</p> <ul> <li> <p>If path ends with a slash, the backend will consider this as a directory and will perform a directory listing or will display index document.   Example: <code>GET /dir1/</code></p> </li> <li> <p>If path doesn't end with a slash, the backend will consider this as a file request. Example: <code>GET /file.pdf</code></p> </li> </ul>"},{"location":"feature-guide/api/#head","title":"HEAD","text":"<p>Those kind of requests is similar to <code>GET</code> ones but won't provide any result body.</p> <p>There are working the same way for management cases for directories (eg: <code>HEAD /dir1/</code>) or files (eg: <code>HEAD /file.pdf</code>).</p> <p>GET and HEAD requests include standard S3 headers (<code>Cache-Control</code>, <code>Content-Type</code>, <code>ETag</code>, <code>Last-Modified</code>, etc.) and add a <code>Content-Digest</code> header when the S3 object has a <code>FULL_OBJECT</code> checksum of algorithm SHA-256, SHA-1, CRC32C, or CRC32 (but not CRC64NVME or MD5).</p>"},{"location":"feature-guide/api/#put","title":"PUT","text":"<p>This kind of requests will allow to send file in directory (so to upload a file in S3).</p> <p>The PUT request path must be a directory and must be a multipart form with a key named <code>file</code> with a file inside. Example: <code>PUT --form file:@file.pdf /dir1/</code></p>"},{"location":"feature-guide/api/#delete","title":"DELETE","text":"<p>This kind of requests will allow to delete files (only). Folder removal is forbidden at this moment.</p> <p>The DELETE request path must contain the file name. Example: <code>DELETE /dir1/dir2/file.pdf</code>.</p>"},{"location":"feature-guide/authorization-accesses/","title":"Authorization accesses: How it works ?","text":""},{"location":"feature-guide/authorization-accesses/#general","title":"General","text":"<p>The authorization accesses list coming from ResourceHeaderOIDC are accesses matrix by group or email. If not set, authenticated users will be authorized (no group or email validation will be performed if <code>authorizationOPAServer</code> isn't set).</p> <p>Moreover, this is based on the \"OR\" principle. Another way to say it is: you are authorized as soon as 1 thing (email or group) is matching.</p> <p>To conclude, if you want to have a AND accesses list (following the example before, only Jean Dupont is authorized), you will have to change the authorization mechanism to OPAServerAuthorization and check feature guide here.</p>"},{"location":"feature-guide/authorization-accesses/#examples","title":"Examples","text":""},{"location":"feature-guide/authorization-accesses/#empty-list","title":"Empty list","text":"<p>Example of authorization accesses configuration:</p> <pre><code>targets:\n  target1:\n    resources:\n      - path: /*\n        provider: provider1\n        oidc:\n          authorizationAccesses: []\n     bucket:\n       ...\n</code></pre> <p>We consider those users:</p> <ul> <li>Jean Dupont with <code>group1</code> and <code>group2</code> groups</li> <li>Ast\u00e9rix with <code>group1</code> and <code>group3</code> groups</li> <li>Ob\u00e9lix with <code>group3</code> group</li> </ul> <p>Accesses will be:</p> <ul> <li>Jean Dupont: Authorized because list is empty</li> <li>Ast\u00e9rix: Authorized because list is empty</li> <li>Ob\u00e9lix: Authorized because list is empty</li> </ul>"},{"location":"feature-guide/authorization-accesses/#group-matching","title":"Group matching","text":"<p>Example of authorization accesses configuration:</p> <pre><code>targets:\n  target1:\n    resources:\n      - path: /*\n        provider: provider1\n        oidc:\n          authorizationAccesses:\n            - group: group1\n            - group: group2\n     bucket:\n       ...\n</code></pre> <p>We consider those users:</p> <ul> <li>Jean Dupont with <code>group1</code> and <code>group2</code> groups</li> <li>Ast\u00e9rix with <code>group1</code> and <code>group3</code> groups</li> <li>Ob\u00e9lix with <code>group3</code> group</li> </ul> <p>Accesses will be:</p> <ul> <li>Jean Dupont: Ok because he is in <code>group1</code> (and <code>group2</code> but this one isn't matching the first)</li> <li>Ast\u00e9rix: Ok because he is in <code>group1</code></li> <li>Ob\u00e9lix: Forbidden because he isn't in any of <code>group1</code> or <code>group2</code></li> </ul>"},{"location":"feature-guide/authorization-accesses/#group-regex-matching","title":"Group regex matching","text":"<p>Example of authorization accesses configuration:</p> <pre><code>targets:\n  target1:\n    resources:\n      - path: /*\n        provider: provider1\n        oidc:\n          authorizationAccesses:\n            - group: valid.*\n              regex: true\n     bucket:\n       ...\n</code></pre> <p>We consider those users:</p> <ul> <li>Jean Dupont with <code>valid1</code> and <code>valid2</code> groups</li> <li>Ast\u00e9rix with <code>valid1</code> and <code>group3</code> groups</li> <li>Ob\u00e9lix with <code>group3</code> group</li> </ul> <p>Accesses will be:</p> <ul> <li>Jean Dupont: Ok because he is in <code>valid1</code> and <code>valid2</code></li> <li>Ast\u00e9rix: Ok because he is in <code>valid1</code></li> <li>Ob\u00e9lix: Forbidden because he isn't in any of <code>valid1</code> or <code>valid2</code></li> </ul>"},{"location":"feature-guide/authorization-accesses/#email-matching","title":"Email matching","text":"<p>Example of authorization accesses configuration:</p> <pre><code>targets:\n  target1:\n    resources:\n      - path: /*\n        provider: provider1\n        oidc:\n          authorizationAccesses:\n            - email: jean.dupont@fake.com\n     bucket:\n       ...\n</code></pre> <p>We consider those users:</p> <ul> <li>Jean Dupont with <code>jean.dupont@fake.com</code> email</li> <li>Ast\u00e9rix with <code>asterix@fake.com</code> email</li> <li>Ob\u00e9lix with <code>obelix@fake.com</code> email</li> </ul> <p>Accesses will be:</p> <ul> <li>Jean Dupont: authorized</li> <li>Ast\u00e9rix: forbidden</li> <li>Ob\u00e9lix: forbidden</li> </ul>"},{"location":"feature-guide/authorization-accesses/#email-regex-matching","title":"Email regex matching","text":"<p>Example of authorization accesses configuration:</p> <pre><code>targets:\n  target1:\n    resources:\n      - path: /*\n        provider: provider1\n        oidc:\n          authorizationAccesses:\n            - email: .*@fake.com\n              regex: true\n     bucket:\n       ...\n</code></pre> <p>We consider those users:</p> <ul> <li>Jean Dupont with <code>jean.dupont@fake.com</code> email</li> <li>Ast\u00e9rix with <code>asterix@fake.com</code> email</li> <li>Ob\u00e9lix with <code>obelix@another.com</code> email</li> </ul> <p>Accesses will be:</p> <ul> <li>Jean Dupont: authorized</li> <li>Ast\u00e9rix: authorized</li> <li>Ob\u00e9lix: forbidden</li> </ul>"},{"location":"feature-guide/authorization-accesses/#forbidden-case","title":"Forbidden case","text":"<p>Note</p> <p>This have been done because there isn't any way of doing a negative match on regex. The only way is to match a regex with a forbidden flag enabled.</p> <p>Example of authorization accesses configuration:</p> <pre><code>targets:\n  target1:\n    resources:\n      - path: /*\n        provider: provider1\n        oidc:\n          authorizationAccesses:\n            - email: asterix@fake.com\n              regex: true\n              forbidden: true\n            - email: .*@fake.com\n              regex: true\n     bucket:\n       ...\n</code></pre> <p>We consider those users:</p> <ul> <li>Jean Dupont with <code>jean.dupont@fake.com</code> email</li> <li>Ast\u00e9rix with <code>asterix@fake.com</code> email</li> <li>Ob\u00e9lix with <code>obelix@another.com</code> email</li> </ul> <p>Accesses will be:</p> <ul> <li>Jean Dupont: authorized</li> <li>Ast\u00e9rix: forbidden because it is marked as forbidden and it is the first in the list</li> <li>Ob\u00e9lix: forbidden</li> </ul>"},{"location":"feature-guide/cache-control/","title":"Cache headers control","text":"<p>The server allow to control the cache headers at the server level or directly on a template file response or on streamed files. The following options are presented below.</p>"},{"location":"feature-guide/cache-control/#no-cache","title":"No Cache","text":"<p>Warning</p> <p>This will override all headers applied on a template or a streamed file.</p> <p>This configuration by default enabled for all responses including templates and streamed files. This is enabled by default for security reasons and to force no cache on everything.</p> <p>Here is an example to enforce this default value:</p> <pre><code>server:\n  # Cache configuration\n  cache:\n    # Force no cache headers on all responses\n    noCacheEnabled: true\n</code></pre>"},{"location":"feature-guide/cache-control/#global-cache-control","title":"Global cache control","text":"<p>Warning</p> <p>This will override all headers applied on a template or a streamed file.</p> <p>This will allow to manage all cache headers values for all responses including templates and streamed files.</p> <pre><code>server:\n  # Cache configuration\n  cache:\n    # Force no cache headers on all responses\n    noCacheEnabled: false\n    # Expires header value\n    expires:\n    # Cache-control header value\n    cacheControl:\n    # Pragma header value\n    pragma:\n    # X-Accel-Expires header value\n    xAccelExpires:\n</code></pre>"},{"location":"feature-guide/cache-control/#global-etag-support","title":"Global ETag support","text":"<p>Warning</p> <p>This will override all headers applied on a template or a streamed file.</p> <p>This configuration will be applied to all responses, for all requests.</p> <p>Here is an example of configuration to allow ETag support globally:</p> <pre><code>server:\n  # Cache configuration\n  cache:\n    # Force no cache headers on all responses\n    noCacheEnabled: false\n    # Cache-control header value\n    cacheControl: must-revalidate, max-age=0\n</code></pre>"},{"location":"feature-guide/cache-control/#etag-specific-template-file-header","title":"ETag specific template file header","text":"<p>You can override the headers on a specific template to add <code>Cache-Control</code> and others on it.</p> <p>The following example will show how to disable the \"no-cache\" feature and add a <code>Cache-Control</code> header that will allow the ETag support in browsers:</p> <pre><code>server:\n  # Cache configuration\n  cache:\n    # Force no cache headers on all responses\n    noCacheEnabled: false\n\n# Template configurations\ntemplates:\n  targetList:\n    path: templates/target-list.tpl\n    headers:\n      Content-Type: '{{ template \"main.headers.contentType\" . }}'\n      Cache-Control: must-revalidate, max-age=0\n</code></pre>"},{"location":"feature-guide/cache-control/#etag-specific-stream-file-header","title":"ETag specific stream file header","text":"<p>You can override the headers on streamed files to add <code>Cache-Control</code> and others on them.</p> <p>The following example will show how to disable the \"no-cache\" feature and add a <code>Cache-Control</code> header that will allow the ETag support in browsers:</p> <pre><code>server:\n  # Cache configuration\n  cache:\n    # Force no cache headers on all responses\n    noCacheEnabled: false\n\n# Targets map\ntargets:\n  first-bucket:\n    ## Actions\n    actions:\n      # Action for GET requests on target\n      GET:\n        # Will allow GET requests\n        enabled: true\n        # Configuration for GET requests\n        config:\n          # Allow to add headers to streamed files (can be templated)\n          streamedFileHeaders:\n            Cache-Control: must-revalidate, max-age=0\n</code></pre>"},{"location":"feature-guide/internal-api/","title":"Internal API","text":"<p>This API is served by the internal server port and shouldn't be public. The aim of this one it to provide internal services like monitoring, health status or debug configuration.</p>"},{"location":"feature-guide/internal-api/#health","title":"/health","text":"<p>This endpoint will give the status of the application. This will either answer with</p> <ul> <li>a 200 status code and a json body when everything is ok</li> <li>a 500 status code and a json body explaining why there is a problem</li> </ul>"},{"location":"feature-guide/internal-api/#metrics","title":"/metrics","text":"<p>This endpoint will give metrics with the prometheus format.</p>"},{"location":"feature-guide/internal-api/#config","title":"/config","text":"<p>This endpoint will show the latest configuration loaded by the application. Data are changed each time application is reloading the configuration.</p> <p>Everything is shown in json format with the same keys are in the yaml configuration files.</p> <p>Important note: Secret values aren't displayed. Only environment variable names and file paths.</p> <p>Here is a payload example:</p> <pre><code>{\n  \"config\": {\n    \"log\": { \"level\": \"info\", \"format\": \"json\", \"filePath\": \"\" },\n    \"tracing\": {\n      \"fixedTags\": null,\n      \"flushInterval\": \"\",\n      \"udpHost\": \"\",\n      \"queueSize\": 0,\n      \"enabled\": false,\n      \"logSpan\": false\n    },\n    \"metrics\": { \"disableRouterPath\": false },\n    \"server\": {\n      \"timeouts\": {\n        \"readTimeout\": \"\",\n        \"readHeaderTimeout\": \"60s\",\n        \"writeTimeout\": \"\",\n        \"idleTimeout\": \"\"\n      },\n      \"cors\": null,\n      \"cache\": null,\n      \"compress\": {\n        \"enabled\": true,\n        \"types\": [\n          \"text/html\",\n          \"text/css\",\n          \"text/plain\",\n          \"text/javascript\",\n          \"application/javascript\",\n          \"application/x-javascript\",\n          \"application/json\",\n          \"application/atom+xml\",\n          \"application/rss+xml\",\n          \"image/svg+xml\"\n        ],\n        \"level\": 5\n      },\n      \"ssl\": null,\n      \"listenAddr\": \"\",\n      \"port\": 8080\n    },\n    \"internalServer\": {\n      \"timeouts\": {\n        \"readTimeout\": \"\",\n        \"readHeaderTimeout\": \"60s\",\n        \"writeTimeout\": \"\",\n        \"idleTimeout\": \"\"\n      },\n      \"cors\": null,\n      \"cache\": null,\n      \"compress\": {\n        \"enabled\": true,\n        \"types\": [\n          \"text/html\",\n          \"text/css\",\n          \"text/plain\",\n          \"text/javascript\",\n          \"application/javascript\",\n          \"application/x-javascript\",\n          \"application/json\",\n          \"application/atom+xml\",\n          \"application/rss+xml\",\n          \"image/svg+xml\"\n        ],\n        \"level\": 5\n      },\n      \"ssl\": null,\n      \"listenAddr\": \"\",\n      \"port\": 9090\n    },\n    \"targets\": {\n      \"test\": {\n        \"bucket\": {\n          \"credentials\": null,\n          \"requestConfig\": null,\n          \"name\": \"bucket1\",\n          \"prefix\": \"\",\n          \"region\": \"us-east-1\",\n          \"s3Endpoint\": \"\",\n          \"s3ListMaxKeys\": 1000,\n          \"s3MaxUploadParts\": 10000,\n          \"s3UploadPartSize\": 5,\n          \"s3UploadConcurrency\": 5,\n          \"s3UploadLeavePartsOnError\": false,\n          \"disableSSL\": false,\n          \"credentials\": {\n            \"accessKey\": { \"env\": \"FAKE\", \"path\": \"\" },\n            \"secretKey\": { \"path\": \"/secret\", \"env\": \"\" }\n          }\n        },\n        \"resources\": null,\n        \"mount\": { \"host\": \"\", \"path\": [\"/test/\"] },\n        \"actions\": {\n          \"GET\": { \"config\": null, \"enabled\": true },\n          \"PUT\": null,\n          \"DELETE\": null\n        },\n        \"templates\": {\n          \"folderList\": null,\n          \"notFoundError\": null,\n          \"internalServerError\": null,\n          \"forbiddenError\": null,\n          \"unauthorizedError\": null,\n          \"badRequestError\": null,\n          \"put\": null,\n          \"delete\": null,\n          \"helpers\": null\n        },\n        \"keyRewriteList\": null\n      }\n    },\n    \"templates\": {\n      \"folderList\": {\n        \"path\": \"templates/folder-list.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"200\"\n      },\n      \"targetList\": {\n        \"path\": \"templates/target-list.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"200\"\n      },\n      \"notFoundError\": {\n        \"path\": \"templates/not-found-error.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"404\"\n      },\n      \"internalServerError\": {\n        \"path\": \"templates/internal-server-error.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"500\"\n      },\n      \"unauthorizedError\": {\n        \"path\": \"templates/unauthorized-error.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"401\"\n      },\n      \"forbiddenError\": {\n        \"path\": \"templates/forbidden-error.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"403\"\n      },\n      \"badRequestError\": {\n        \"path\": \"templates/bad-request-error.tpl\",\n        \"headers\": {\n          \"Content-Type\": \"{{ template \\\"main.headers.contentType\\\" . }}\"\n        },\n        \"status\": \"400\"\n      },\n      \"put\": { \"path\": \"templates/put.tpl\", \"headers\": {}, \"status\": \"204\" },\n      \"delete\": {\n        \"path\": \"templates/delete.tpl\",\n        \"headers\": {},\n        \"status\": \"204\"\n      },\n      \"helpers\": [\"templates/_helpers.tpl\"]\n    },\n    \"authProviders\": null,\n    \"listTargets\": { \"mount\": null, \"resource\": null, \"enabled\": false }\n  }\n}\n</code></pre>"},{"location":"feature-guide/key-rewrite/","title":"Key Rewrite","text":""},{"location":"feature-guide/key-rewrite/#what-is-a-key","title":"What is a \"key\" ?","text":"<p>In S3, \"path\" are called \"key\". This means for S3-Proxy that when a client is calling with this type of request: <code>GET /test/file.html</code>, the S3 key will be <code>/test/file.html</code> (this example consider that S3 prefix and mount path are empty).</p>"},{"location":"feature-guide/key-rewrite/#general-description","title":"General description","text":"<p>The key rewrite feature is here to add the idea of url rewrite for S3 calls.</p> <p>The list is provided per target and don't skip the S3 prefix configured in the bucket section.</p> <p>Moreover, this list is tested over all actions (GET, PUT or DELETE) without any filter. This is done on purpose in order to be agnostic of client requests.</p> <p>This can be considered as similar as symlinks in Unix.</p>"},{"location":"feature-guide/key-rewrite/#how-this-is-working","title":"How this is working ?","text":"<p>The list of key rewrite is called over all incoming keys that will be sent to S3 (S3 prefix included).</p> <p>The first source regexp matching the key will select the target template that will be used. If nothing is matching, the incoming key will be untouched.</p> <p>There are some things that should be known about this feature:</p> <ul> <li>As the project is done with Golang, the regexp must be compatible with this language. The group namings are supported in source and can be used in target template.</li> <li>S3 Prefix declared in the bucket configuration won't be present in the source key. This is done on purpose because this is configuration that should be added to all keys before calling S3.</li> <li>The index document feature is called after the key rewrite feature. So the source key won't contains any <code>indexDocument</code> inside.</li> <li>The <code>redirectWithTrailingSlashForNotFoundFile</code> feature is also called after the key rewrite feature.</li> <li>For PUT and DELETE actions, the entire key is provided before calling the key rewrite feature. This means that the file name is included in the source key. This is done on purpose because DELETE and PUT actions are done on files, so it should be included in source key before calling the key rewrite feature.</li> <li>Sometimes, simple Regexp aren't enough. There is a possibility to use Golang templates for target templates and have access to data of incoming requests.</li> </ul>"},{"location":"feature-guide/key-rewrite/#for-which-situations","title":"For which situations ?","text":"<p>This feature is done because it can happened that it is needed to rewrite keys before calling S3.</p> <p>This can happened when:</p> <ul> <li>An old application has been delivered and not updated that try to get a file on a specific URL and you moved this file to another location. Now, you can create a key rewrite in order to \"redirect\" the call to the new place.</li> <li>A website has been moved in the S3 storage and you want the old URL to continue to work for a given amount of time.</li> </ul> <p>And other examples...</p>"},{"location":"feature-guide/key-rewrite/#examples","title":"Examples","text":"<p>Examples below will have a small configuration containing just the needed keys related to the example.</p>"},{"location":"feature-guide/key-rewrite/#ignored-key","title":"Ignored key","text":"<p>This example will show the ignore key behavior explained before.</p> <p>In this example, we will consider this request <code>GET /file.html</code> and the following configuration:</p> <pre><code># ...\ntargets:\n  - name: test\n    # ...\n    keyRewriteList:\n      - source: ^/my-super-complicated-path$\n        target: /redirected\n    bucket:\n      # ...\n      prefix: \"\"\n</code></pre> <p>The S3 key result of this request will be : <code>/file.html</code>.</p>"},{"location":"feature-guide/key-rewrite/#simple-key-rewrite","title":"Simple key rewrite","text":"<p>This example will show a simple key rewrite without any group name or capture.</p> <p>In this example, we will consider this request <code>GET /file.html</code> and the following configuration:</p> <pre><code># ...\ntargets:\n  - name: test\n    # ...\n    keyRewriteList:\n      - source: ^/file.html$\n        target: /redirected/file.html\n    bucket:\n      # ...\n      prefix: \"\"\n</code></pre> <p>The S3 key result of this request will be : <code>/redirected/file.html</code>.</p>"},{"location":"feature-guide/key-rewrite/#golang-naming-groups","title":"Golang naming groups","text":"<p>This example will show a capture with name reused in template.</p> <p>In this example, we will consider this request <code>GET /folder1/file.html</code> and the following configuration:</p> <pre><code># ...\ntargets:\n  - name: test\n    # ...\n    keyRewriteList:\n      - source: ^/(?P&lt;one&gt;\\w+)/file.html$\n        target: /$one/fake/$one/file.html\n    bucket:\n      # ...\n      prefix: \"\"\n</code></pre> <p>The S3 key result of this request will be : <code>/folder1/fake/folder1/file.html</code>.</p>"},{"location":"feature-guide/key-rewrite/#s3-prefix","title":"S3 prefix","text":"<p>This example will show a simple key rewrite with the S3 prefix data.</p> <p>In this example, we will consider this request <code>GET /file.html</code> and the following configuration:</p> <pre><code># ...\ntargets:\n  - name: test\n    # ...\n    keyRewriteList:\n      - source: ^/folder1/file.html$\n        target: /folder1/redirected/file.html\n    bucket:\n      # ...\n      prefix: \"/folder1\"\n</code></pre> <p>The bucket prefix is in fact added before any key rewrite list item matching.</p> <p>The S3 key result of this request will be : <code>/folder1/redirected/file.html</code>.</p>"},{"location":"feature-guide/key-rewrite/#simple-target-as-golang-template","title":"Simple target as Golang template","text":"<p>This example will show a simple key rewrite without any group name or capture.</p> <p>In this example, we will consider this request <code>GET /file.html</code> with a User connected with username <code>myuser</code> and the following configuration:</p> <pre><code># ...\ntargets:\n  - name: test\n    # ...\n    keyRewriteList:\n      - source: ^/file.html$\n        targetType: TEMPLATE\n        target: \"/{{ .User.Username }}/redirected/file.html\"\n    bucket:\n      # ...\n      prefix: \"\"\n</code></pre> <p>The S3 key result of this request will be : <code>/myuser/redirected/file.html</code>.</p> <p>See in TargetKeyRewriteData available for templates.</p>"},{"location":"feature-guide/key-rewrite/#advanced-target-as-golang-template","title":"Advanced target as Golang template","text":"<p>This example will show a simple key rewrite without any group name or capture.</p> <p>In this example, we will consider this request <code>GET /input1/input2/file.html</code> with a User connected with username <code>myuser</code> and the following configuration:</p> <pre><code># ...\ntargets:\n  - name: test\n    # ...\n    keyRewriteList:\n      - source: ^/input.*$\n        targetType: TEMPLATE\n        target: \"{{ regexReplaceAll \"/input1(/.*)\" .Key (printf \"/input1/%s${1}\" .User.Username) }}\"\n    bucket:\n      # ...\n      prefix: \"\"\n</code></pre> <p>The S3 key result of this request will be : <code>/input1/myuser/input2/file.html</code>.</p> <p>See in TargetKeyRewriteData available for templates.</p>"},{"location":"feature-guide/opa/","title":"Open Policy Agent (OPA)","text":"<p>S3-proxy integrate Open Policy Agent for authorization process after OpenID Connect or Header based logins.</p>"},{"location":"feature-guide/opa/#integration","title":"Integration","text":"<p>This project integrate OPA with the REST API. You can see an example here. In the project configuration, you just have to put the link to the data endpoint with \"allowed rego\" path. Here is the example from the OPA website: http://localhost:8181/v1/data/example/authz/allow</p>"},{"location":"feature-guide/opa/#input-data","title":"Input data","text":"<p>The following section will present the input data that s3-proxy will send to the Open Policy Agent.</p> <pre><code>{\n  \"input\": {\n    \"user\": {\n      \"preferred_username\": \"user\",\n      \"name\": \"Sample User\",\n      \"groups\": [\"group1\"],\n      \"given_name\": \"Sample\",\n      \"family_name\": \"User\",\n      \"email\": \"sample-user@example.com\",\n      \"email_verified\": true\n    },\n    \"request\": {\n      \"method\": \"GET\",\n      \"protocol\": \"HTTP/1.1\",\n      \"headers\": {\n        \"accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\n        \"accept-encoding\": \"gzip, deflate, br\",\n        \"accept-language\": \"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7\",\n        \"cache-control\": \"max-age=0\",\n        \"connection\": \"keep-alive\",\n        \"cookie\": \"oidc=TOKEN\",\n        \"sec-fetch-dest\": \"document\",\n        \"sec-fetch-mode\": \"navigate\",\n        \"sec-fetch-site\": \"none\",\n        \"sec-fetch-user\": \"?1\",\n        \"upgrade-insecure-requests\": \"1\",\n        \"user-agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36\"\n      },\n      \"remoteAddr\": \"[::1]:51092\",\n      \"scheme\": \"http\",\n      \"host\": \"localhost:8080\",\n      \"parsed_path\": [\"v2\"],\n      \"path\": \"/v2/\"\n    },\n    \"tags\": {\n      \"fake\": \"tag\"\n    }\n  }\n}\n</code></pre>"},{"location":"feature-guide/opa/#output-data","title":"Output Data","text":"<p>Here is an example of the expected output schema:</p> <pre><code>{\n  \"result\": true\n}\n</code></pre>"},{"location":"feature-guide/prometheus-metrics/","title":"Prometheus Metrics","text":"<p>This section will describe the prometheus metrics that the application is serving.</p> <p>Here is also an example of Prometheus dashboard that you can import as JSON file: dashboard.</p> <p>This dashboard has been done and tested on Grafana 7.0.</p>"},{"location":"feature-guide/prometheus-metrics/#http_requests_total","title":"http_requests_total","text":"<p>Type: Counter</p> <p>Prometheus data:</p> <ul> <li><code>http_requests_total</code></li> </ul> <p>Description: How many HTTP requests have been processed ?</p> <p>Fields:</p> Field name Description <code>server</code> Which Server is handling the request ? Can be \"business\" or \"internal\". Internal is the server handling requests for metrics, health check. <code>status_code</code> Request status code <code>method</code> Request method <code>host</code> Hostname used for the request <code>path</code> Path used for the request"},{"location":"feature-guide/prometheus-metrics/#http_request_duration_seconds","title":"http_request_duration_seconds","text":"<p>Type: Summary</p> <p>Prometheus data:</p> <ul> <li><code>http_request_duration_seconds_sum</code></li> <li><code>http_request_duration_seconds_count</code></li> </ul> <p>Description: The HTTP request latencies in seconds.</p> <p>Fields:</p> Field name Description <code>server</code> Which Server is handling the request ? Can be \"business\" or \"internal\". Internal is the server handling requests for metrics, health check. <code>status_code</code> Request status code <code>method</code> Request method <code>host</code> Hostname used for the request <code>path</code> Path used for the request"},{"location":"feature-guide/prometheus-metrics/#http_request_size_bytes","title":"http_request_size_bytes","text":"<p>Type: Summary</p> <p>Prometheus data:</p> <ul> <li><code>http_request_size_bytes_sum</code></li> <li><code>http_request_size_bytes_count</code></li> </ul> <p>Description: The HTTP request sizes in bytes.</p> <p>Fields:</p> Field name Description <code>server</code> Which Server is handling the request ? Can be \"business\" or \"internal\". Internal is the server handling requests for metrics, health check. <code>status_code</code> Request status code <code>method</code> Request method <code>host</code> Hostname used for the request <code>path</code> Path used for the request"},{"location":"feature-guide/prometheus-metrics/#http_response_size_bytes","title":"http_response_size_bytes","text":"<p>Type: Summary</p> <p>Prometheus data:</p> <ul> <li><code>http_response_size_bytes_sum</code></li> <li><code>http_response_size_bytes_count</code></li> </ul> <p>Description: The HTTP response sizes in bytes.</p> <p>Fields:</p> Field name Description <code>server</code> Which Server is handling the request ? Can be \"business\" or \"internal\". Internal is the server handling requests for metrics, health check. <code>status_code</code> Request status code <code>method</code> Request method <code>host</code> Hostname used for the request <code>path</code> Path used for the request"},{"location":"feature-guide/prometheus-metrics/#up","title":"up","text":"<p>Type: Gauge</p> <p>Prometheus data:</p> <ul> <li><code>up</code></li> </ul> <p>Description: 1 = up (hardcoded)</p> Field name Description component Component name (hardcoded with <code>s3-proxy</code>)"},{"location":"feature-guide/prometheus-metrics/#s3_operations_total","title":"s3_operations_total","text":"<p>Type: Counter</p> <p>Prometheus data:</p> <ul> <li><code>s3_operations_total</code></li> </ul> <p>Description: How many operations are generated to s3 in total ?</p> <p>Fields:</p> Field name Description <code>target_name</code> Target name <code>bucket_name</code> Bucket name <code>operation</code> S3 operation"},{"location":"feature-guide/prometheus-metrics/#authenticated_total","title":"authenticated_total","text":"<p>Type: Counter</p> <p>Prometheus data:</p> <ul> <li><code>authenticated_total</code></li> </ul> <p>Description: How many users have been authenticated ?</p> <p>Fields:</p> Field name Description <code>provider_type</code> Provider type (<code>oidc</code> or <code>basic-auth</code> for example) <code>provider_name</code> Provider name"},{"location":"feature-guide/prometheus-metrics/#authorized_total","title":"authorized_total","text":"<p>Type: Counter</p> <p>Prometheus data:</p> <ul> <li><code>authorized_total</code></li> </ul> <p>Description: How many users have been authorized ?</p> <p>Fields:</p> Field name Description <code>provider_type</code> Provider type (<code>oidc-opa</code> or <code>basic-auth</code> for example)"},{"location":"feature-guide/prometheus-metrics/#succeed_webhooks_total","title":"succeed_webhooks_total","text":"<p>Type: Counter</p> <p>Prometheus data:</p> <ul> <li><code>succeed_webhooks_total</code></li> </ul> <p>Description: How many webhooks have been succeed ?</p> <p>Fields:</p> Field name Description <code>target_name</code> Target name containing the webhook definition <code>action_name</code> Webhook action triggered (<code>GET</code>, <code>PUT</code> or <code>DELETE</code>)"},{"location":"feature-guide/prometheus-metrics/#failed_webhooks_total","title":"failed_webhooks_total","text":"<p>Type: Counter</p> <p>Prometheus data:</p> <ul> <li><code>failed_webhooks_total</code></li> </ul> <p>Description: How many webhooks have been failed ?</p> <p>Fields:</p> Field name Description <code>target_name</code> Target name containing the webhook definition <code>action_name</code> Webhook action triggered (<code>GET</code>, <code>PUT</code> or <code>DELETE</code>)"},{"location":"feature-guide/signed-url/","title":"Signed URL","text":"<p>This feature have been done to avoid steaming files through S3-Proxy application and to redirect directly to S3 to perform this operation. This will help when you have a small throughput or stability issues.</p>"},{"location":"feature-guide/signed-url/#limitations","title":"Limitations","text":"<ul> <li>This is supported only for GET requests.</li> </ul>"},{"location":"feature-guide/signed-url/#configuration","title":"Configuration","text":"<p>Simply enable it in the configuration:</p> <pre><code>#...\ntargets:\n  target1:\n    #...\n    actions:\n      GET:\n        enabled: true\n        config:\n          # Redirect to a S3 signed URL\n          redirectToSignedUrl: true\n          # Signed URL expiration time\n          signedUrlExpiration: 15m\n          # ...\n</code></pre>"},{"location":"feature-guide/templates/","title":"Templates","text":"<p>The template feature will allow to customize the response body, status code and headers given by the application for many responses.</p> <p>All templates managed by S3-Proxy are Golang templates.</p>"},{"location":"feature-guide/templates/#managed-responses","title":"Managed responses","text":"<p>S3-Proxy will manage HTML and JSON responses automatically by default. This switch is performed according to the <code>Accept</code> request header.</p> <p>If no <code>Accept</code> header in found in the request, the HTML output will be used by default.</p> <p>Default templates can be found here.</p>"},{"location":"feature-guide/templates/#functions","title":"Functions","text":""},{"location":"feature-guide/templates/#general-functions","title":"General functions","text":"<p>In all these templates, all Masterminds/sprig functions are available.</p>"},{"location":"feature-guide/templates/#s3-proxy-specific-functions","title":"S3-Proxy specific functions","text":"<p>In all these templates, S3-Proxy specific functions are available:</p> <ul> <li><code>humanSize</code> with <code>int</code> input in order to transform bytes to human size</li> <li><code>requestURI</code> with <code>http.Request</code> input in order to get the full request URI from incoming request</li> <li><code>requestScheme</code> with <code>http.Request</code> input in order to get the scheme from incoming request</li> <li><code>requestHost</code> with <code>http.Request</code> input in order to get the hostname from incoming request</li> <li><code>include</code> with template name defined in helpers and context in order to execute a template with the ability to save result in a variable, use it pipelines, ... (Imported from Helm). Example: <code>{{ $var := include \"defined-name\" . }}</code></li> <li><code>toJson</code> will allow to transform a string to a JSON compatible one</li> <li><code>toYaml</code> will allow to transform a string to a YAML compatible one</li> <li><code>tpl</code> is inspired from the Helm one. It allows to render a template in a template rendering session. The first parameter is the template and the second, variables to use in</li> </ul>"},{"location":"feature-guide/templates/#helpers","title":"Helpers","text":"<p>Different helpers are available by default:</p> <ul> <li><code>main.userIdentifier</code> will return the user identifier from the incoming request only if user exists</li> <li><code>main.headers.contentType</code> will return the content type header from the incoming request</li> <li><code>main.body.errorJsonBody</code> will return the json content body for an error</li> </ul>"},{"location":"feature-guide/templates/#templates-data-structure-and-usage","title":"Templates data structure and usage","text":""},{"location":"feature-guide/templates/#target-list","title":"Target List","text":"<p>This template is used in order to list all target buckets declared in the configuration file.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Targets Map[String]target The target map as coming from the configuration <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#folder-list","title":"Folder List","text":"<p>This template is used in order to list files and folders in a bucket \"folder\".</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Entries [Entry] Folder entries BucketName String Bucket name Name String Target name <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#not-found-error","title":"Not found error","text":"<p>This template is used for all <code>Not found</code> errors.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Error Error Error raised and caught <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#unauthorized-error","title":"Unauthorized error","text":"<p>This template is used for all <code>Unauthorized</code> errors.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Error Error Error raised and caught <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#forbidden-error","title":"Forbidden error","text":"<p>This template is used for all <code>Forbidden</code> errors.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Error Error Error raised and caught <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#internal-server-error","title":"Internal Server Error","text":"<p>This template is used for all <code>Internal server error</code> errors.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Error Error Error raised and caught <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#bad-request-error","title":"Bad Request error","text":"<p>This template is used for all <code>Bad Request</code> errors.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Error Error Error raised and caught <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#put","title":"Put","text":"<p>This template is used for all <code>PUT</code> response.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang PutData PutData Put Data <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#delete","title":"Delete","text":"<p>This template is used for all <code>DELETE</code> response.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang DeleteData DeleteData Delete Data <p>Available for:</p> <ul> <li>Response body</li> <li>Response headers</li> <li>Response status code</li> </ul>"},{"location":"feature-guide/templates/#streamed-file","title":"Streamed file","text":"<p>This case is a special case, used only when a file is streamed from S3. This will allow to add headers to streamed files with GET requests.</p> <p>The following table will show the data structure available for the header template rendering:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang StreamFile StreamFile Stream file object <p>Available for:</p> <ul> <li>Response headers</li> </ul>"},{"location":"feature-guide/templates/#put-metadata-and-storage-class","title":"PUT Metadata and Storage class","text":""},{"location":"feature-guide/templates/#put-metadata","title":"PUT Metadata","text":"<p>This case will be used for all PUT metadata templates.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Input PutInput PutInput structure data Key String The final S3 key generated for upload request"},{"location":"feature-guide/templates/#put-storage-class","title":"PUT Storage class","text":"<p>This case will be used for all PUT storage class templates.</p> <p>Available data:</p> Name Type Description User GenericUser Authenticated user if present in incoming request Input PutInput PutInput structure data Key String The final S3 key generated for upload request"},{"location":"feature-guide/templates/#commonother-structures","title":"Common/Other structures","text":""},{"location":"feature-guide/templates/#genericuser","title":"GenericUser","text":"<p>Generic user is a golang interface that will match all kind of users managed by application.</p> <p>These are the properties available:</p> Name Type Description GetType String Get type of user (OIDC or BASIC) GetIdentifier String Get identifier (Username for basic auth user or Username or email for OIDC user) GetUsername String Get username GetName String Get name (only available for OIDC user) GetGroups [String] Get groups (only available for OIDC user) GetGivenName String Get given name (only available for OIDC user) GetFamilyName String Get family name (only available for OIDC user) GetEmail String Get email (only available for OIDC user) IsEmailVerified Boolean Is Email Verified ? (only available for OIDC user)"},{"location":"feature-guide/templates/#entry","title":"Entry","text":"Name Type Description Type String Entry type (FOLDER or FILE) Name String Entry name ETag String ETag from bucket (file only) LastModified Time Last modified entry Size Integer Entry file (file only) Key String Full key from S3 response Path String Access path to entry from web"},{"location":"feature-guide/templates/#streamfile","title":"StreamFile","text":"Name Type Description CacheControl String Cache control value from S3 Expires String Expires value from S3 ContentDisposition String Content disposition value from S3 ContentEncoding String Content encoding value from S3 ContentLanguage String Content language value from S3 ContentLength Integer Content length value from S3 ContentRange String Content range value from S3 ContentType String Content type value from S3 ContentDigest String Content hash if available ETag String ETag value from S3 LastModified Time Last modified value from S3 Metadata Map[String]String Metadata value from S3"},{"location":"feature-guide/templates/#putinput","title":"PutInput","text":"Name Type Description RequestPath String Request path Filename String Filename used for upload ContentType String File content type for upload ContentSize Integer File content size for upload"},{"location":"feature-guide/templates/#putdata","title":"PutData","text":"Name Type Description Key String Full key from S3 response Filename String Filename used for upload ContentType String File content type for upload ContentSize Integer File content size for upload Metadata Map[String]String Metadata value from S3 StorageClass String Storage class"},{"location":"feature-guide/templates/#deletedata","title":"DeleteData","text":"Name Type Description Key String Full key from S3 response"},{"location":"feature-guide/templates/#targetkeyrewritedata","title":"TargetKeyRewriteData","text":"Name Type Description User GenericUser Authenticated user if present in incoming request Request http.Request HTTP Request object from golang Target Target The current target configuration Key String Full key from S3 response"},{"location":"feature-guide/webhooks/","title":"Webhooks","text":"<p>This feature have been created to have hooks on all type of requests managed by s3-proxy.</p>"},{"location":"feature-guide/webhooks/#limitations","title":"Limitations","text":"<p>These comes with some limitations:</p> <ul> <li>Only HTTP is supported.<ul> <li>Why ? Because we aren't too much managing the maintenance of the app and managing different type of hooks will take a lot of efforts and time.</li> <li>If you need another type of message, we recommend you to develop a sidecar to this application that will transform the request.</li> </ul> </li> <li>mTLS isn't supported.<ul> <li>Same reason as before.</li> </ul> </li> <li>All hooks are run in a Go routine and in a sequential way in this one.</li> <li>Webhook body isn't open to customization.</li> </ul>"},{"location":"feature-guide/webhooks/#body","title":"Body","text":"<p>There is a common way in the application of creating a webhook body.</p> <p>Every hook will have a body built on a common part and only \"input\" section is different.</p> <p>The main body is called the HookBody.</p> <p>Here are all cased for input metadata:</p> <ul> <li>GET: GetInputMetadataHookBody</li> <li>HEAD: HeadInputMetadataHookBody</li> <li>PUT: PutInputMetadataHookBody</li> <li>DELETE: DeleteInputMetadataHookBody</li> </ul>"},{"location":"feature-guide/webhooks/#hookbody","title":"HookBody","text":"Field Type Description action String Webhook action (<code>GET</code>, <code>PUT</code> or <code>DELETE</code>) requestPath String Request path inputMetadata Input metadata cases Input metadata outputMetadata OutputMetadataHookBody Output / result metadata (metadata generated from S3 results) target TargetHookBody Target data"},{"location":"feature-guide/webhooks/#outputmetadatahookbody","title":"OutputMetadataHookBody","text":"Field Type Description bucket String Bucket name requested region String Region where the bucket is located s3Endpoint String S3 endpoint used key String Key requested from S3 bucket"},{"location":"feature-guide/webhooks/#targethookbody","title":"TargetHookBody","text":"Field Type Description name String Target name matching the request"},{"location":"feature-guide/webhooks/#headinputmetadatahookbody","title":"HeadInputMetadataHookBody","text":"Field Type Description ifModifiedSince String <code>If-Modified-Since</code> header value ifMatch String <code>If-Match</code> header value ifNoneMatch String <code>If-None-Match</code> header value ifUnmodifiedSince String <code>If-Unmodified-Since</code> header value"},{"location":"feature-guide/webhooks/#getinputmetadatahookbody","title":"GetInputMetadataHookBody","text":"Field Type Description ifModifiedSince String <code>If-Modified-Since</code> header value ifMatch String <code>If-Match</code> header value ifNoneMatch String <code>If-None-Match</code> header value ifUnmodifiedSince String <code>If-Unmodified-Since</code> header value range String <code>Range</code> header value"},{"location":"feature-guide/webhooks/#putinputmetadatahookbody","title":"PutInputMetadataHookBody","text":"Field Type Description filename String Uploaded file name coming from request form contentType String Uploaded file content type contentSize Integer Uploaded file size"},{"location":"feature-guide/webhooks/#deleteinputmetadatahookbody","title":"DeleteInputMetadataHookBody","text":"<p>In this specific case, there is nothing. The input data is null.</p>"},{"location":"user-guide/aws-policy/","title":"AWS IAM Policy","text":"<p>This application will need some rights on AWS.</p> <p>This is an example of a policy that allow access to <code>&lt;bucket-name&gt;</code> and files in it:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        // Needed for GET API/Action\n        \"s3:ListBucket\",\n        \"s3:GetObject\",\n        // Needed for PUT API/Action\n        \"s3:PutObject\",\n        // Needed for DELETE API/Action\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": [\"arn:aws:s3:::&lt;bucket-name&gt;\", \"arn:aws:s3:::&lt;bucket-name&gt;/*\"]\n    }\n  ]\n}\n</code></pre>"},{"location":"user-guide/deployment/","title":"Deployment","text":""},{"location":"user-guide/deployment/#requirements","title":"Requirements","text":"<p>To deploy, you must configure the application. You can read more about this here.</p>"},{"location":"user-guide/deployment/#kubernetes-helm","title":"Kubernetes - Helm","text":"<p>A helm chart have been created to deploy this in a Kubernetes cluster.</p> <p>You can find it here: https://artifacthub.io/packages/helm/oxyno-zeta/s3-proxy</p> <p>Or directly from source: https://github.com/oxyno-zeta/helm-charts-v2/tree/master/charts/s3-proxy</p> <p>Note</p> <p>This chart allow the configuration hot reload. If you change a configuration file and apply it, the Configmap will be updated in Kubernetes and Kubernetes will change the file mounted and linked to Configmap. This will take around 1 minute (according to my tests).</p>"},{"location":"user-guide/deployment/#docker","title":"Docker","text":"<p>First, write the configuration file in a config folder. That one will be mounted.</p> <p>Run this command:</p> <pre><code>docker run -d --name s3-proxy -p 8080:8080 -p 9090:9090 -v $PWD/conf:/proxy/conf oxynozeta/s3-proxy\n</code></pre>"}]}